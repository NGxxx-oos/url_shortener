# API для сокращения ссылок

Этот проект представляет собой простое API для сокращения URL-адресов, разработанное в рамках тестового задания для позиции Middle Backend Developer (Python). Оно позволяет создавать короткие ссылки из длинных URL и перенаправлять пользователей с коротких кодов на оригинальные адреса.

## Используемые технологии

- **Python 3.12+**: Основной язык разработки.
- **FastAPI**: Современный, быстрый и высокопроизводительный веб-фреймворк для создания API на Python. Он автоматически генерирует интерактивную документацию (Swagger UI/ReDoc).
- **SQLite3**: Легковесная, самодостаточная база данных SQL, используемая без ORM (Object-Relational Mapper) в соответствии с требованиями задания.
- **Pytest**: Мощный инструмент для написания и запуска тестов на Python.
- **Uvicorn**: Быстрый ASGI-сервер для запуска FastAPI-приложений.

## Структура проекта

```
url_shortener/
├── app/
│   ├── __init__.py
│   ├── crud.py         # Операции создания, чтения, обновления, удаления (CRUD) для ссылок
│   ├── database.py     # Подключение к базе данных и инициализация схемы
│   ├── main.py         # Основное приложение FastAPI и определение эндпоинтов
│   ├── models.py       # Модели Pydantic для валидации запросов и ответов
│   └── utils.py        # Вспомогательные функции (например, генерация коротких кодов)
├── tests/
│   ├── __init__.py
│   ├── conftest.py     # Фикстуры Pytest для настройки тестовой базы данных
│   └── test_api.py     # Тесты для API-эндпоинтов
├── .gitignore          # Файл для игнорирования Git-ом временных файлов и папок
├── pyproject.toml      # Конфигурация проекта и управление зависимостями
└── README.md           # Этот файл с описанием проекта
```

## Установка и запуск

1.  **Клонируйте репозиторий (если еще не сделали это):**

    ```bash
    git clone <адрес_репозитория>
    cd url_shortener
    ```

2.  **Создайте и активируйте виртуальное окружение:**

    ```bash
    python3.12 -m venv .venv
    source .venv/bin/activate
    ```

3.  **Установите все необходимые зависимости:**

    ```bash
    pip install -e .[test]
    ```

    Эта команда установит `fastapi`, `uvicorn`, `pydantic`, а также `pytest`, `httpx` и `pytest-cov` для тестирования.

## Запуск приложения

Чтобы запустить FastAPI-приложение, выполните следующую команду из корневой директории проекта:

```bash
uvicorn app.main:app --reload
```

API будет доступно по адресу `http://127.0.0.1:8000`. Интерактивная документация API (Swagger UI) будет доступна по адресу `http://127.0.0.1:8000/docs`.

## API Эндпоинты

### 1. Сокращение URL

- **Эндпоинт**: `POST /shorten`
- **Описание**: Создает новую короткую ссылку для указанного длинного URL.
- **Тело запроса**:

  ```json
  {
    "url": "https://example.com/очень/длинный/адрес",
    "custom_code": "ваш_короткий_код"
  }
  ```

  - `url` (строка, обязательно): Оригинальный длинный URL для сокращения.
  - `custom_code` (строка, необязательно): Пользовательский короткий код. Если не указан, будет сгенерирован случайный 6-символьный код. Длина кода должна быть не менее 3 символов.

- **Ответ (201 Created)**:

  ```json
  {
    "short_url": "http://127.0.0.1:8000/abcdeF",
    "original_url": "https://example.com/очень/длинный/адрес",
    "short_code": "abcdeF"
  }
  ```

- **Ошибки**:
  - `400 Bad Request`: Если `custom_code` уже существует.
  - `422 Unprocessable Entity`: Если URL недействителен или `custom_code` не соответствует требованиям к длине/формату.

### 2. Перенаправление по короткому коду

- **Эндпоинт**: `GET /{code}`
- **Описание**: Перенаправляет на оригинальный длинный URL, связанный с указанным коротким кодом.
- **Параметр пути**:
  - `code` (строка, обязательно): Короткий код.
- **Ответ (307 Temporary Redirect)**: Перенаправление на оригинальный URL.
- **Ошибка**:
  - `404 Not Found`: Если короткий код не найден.

### 3. Обновление сокращенной ссылки (Бонус)

- **Эндпоинт**: `PATCH /{code}`
- **Описание**: Обновляет оригинальный URL, связанный с существующим коротким кодом.
- **Параметр пути**:
  - `code` (строка, обязательно): Короткий код ссылки для обновления.
- **Тело запроса**:

  ```json
  {
    "url": "https://новый-пример.com/"
  }
  ```

  - `url` (строка, обязательно): Новый оригинальный URL.

- **Ответ (200 OK)**:

  ```json
  {
    "short_url": "http://127.0.0.1:8000/abcdeF",
    "original_url": "https://новый-пример.com/",
    "short_code": "abcdeF"
  }
  ```

- **Ошибка**:
  - `404 Not Found`: Если короткий код не найден.

### 4. Удаление сокращенной ссылки (Бонус)

- **Эндпоинт**: `DELETE /{code}`
- **Описание**: Удаляет сокращенную ссылку по ее короткому коду.
- **Параметр пути**:
  - `code` (строка, обязательно): Короткий код ссылки для удаления.
- **Ответ (204 No Content)**: Если ссылка успешно удалена.
- **Ошибка**:
  - `404 Not Found`: Если короткий код не найден.

## Тестирование

Для запуска тестов перейдите в корневую директорию проекта и выполните:

```bash
pytest
```

Для запуска тестов с отчетом о покрытии кода:

```bash
pytest --cov=app
```

## Логирование

События, такие как инициализация базы данных и перенаправления URL, логируются в консоль. Уровень логирования установлен на `INFO`.

## Коммиты

Сообщения коммитов являются описательными и следуют логической последовательности добавления функций и исправлений.
